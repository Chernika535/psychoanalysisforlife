<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞–±–æ—á–∞—è —Ç–µ—Ç—Ä–∞–¥—å —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 16px;
        }

        .header {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #2c3e50;
            padding: 20px 16px;
            text-align: center;
            margin: -16px -16px 20px -16px;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.8;
        }

        .progress-bar {
            background: rgba(44, 62, 80, 0.2);
            height: 6px;
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }

        .progress-fill {
            background: #FF8C00;
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .tab-navigation {
            display: flex;
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            min-width: 70px;
            padding: 12px 6px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 500;
            color: var(--tg-theme-hint-color, #999);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: #FFD700;
            color: #2c3e50;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            background: var(--tg-theme-secondary-bg-color, #f8f9fa);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--tg-theme-text-color, #000);
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--tg-theme-text-color, #000);
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 8px;
            font-size: 14px;
            background: var(--tg-theme-bg-color, white);
            color: var(--tg-theme-text-color, #000);
            resize: vertical;
            min-height: 40px;
        }

        .input-field:focus {
            outline: none;
            border-color: #FFD700;
        }

        .textarea {
            min-height: 80px;
        }

        .scale-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .scale-slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--tg-theme-hint-color, #ddd);
            outline: none;
            -webkit-appearance: none;
        }

        .scale-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFD700;
            cursor: pointer;
        }

        .scale-value {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
            color: #FF8C00;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .checkbox.checked {
            background: #FFD700;
            border-color: #FFD700;
        }

        .checkbox.checked::after {
            content: '‚úì';
            color: #2c3e50;
            font-size: 12px;
            font-weight: bold;
        }

        .btn {
            background: #FFD700;
            color: #2c3e50;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: opacity 0.2s ease;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            color: var(--tg-theme-text-color, #000);
        }

        .daily-tracker {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin: 16px 0;
        }

        .day-cell {
            aspect-ratio: 1;
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .day-cell.completed {
            background: #FFD700;
            color: #2c3e50;
            border-color: #FFD700;
        }

        .day-cell.current {
            background: #FFF3CD;
            border-color: #FF8C00;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .stat-card {
            background: var(--tg-theme-bg-color, white);
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #FF8C00;
        }

        .stat-label {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #666);
            margin-top: 4px;
        }

        .journal-entry {
            background: var(--tg-theme-bg-color, white);
            border: 1px solid #FFD700;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            position: relative;
        }

        .journal-date {
            font-size: 12px;
            color: #FF8C00;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .journal-content {
            font-size: 14px;
            line-height: 1.4;
        }

        .journal-type {
            display: inline-block;
            background: #FFD700;
            color: #2c3e50;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 8px;
        }

        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            opacity: 0.8;
        }

        .weekly-summary {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #2c3e50;
            padding: 16px;
            border-radius: 12px;
            margin: 12px 0;
            position: relative;
        }

        .summary-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .summary-section {
            margin-bottom: 12px;
        }

        .summary-label {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            margin: 16px 0;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            color: var(--tg-theme-text-color, #000);
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn.active {
            background: #FFD700;
            color: #2c3e50;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 1px solid #FFD700;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .no-entries {
            text-align: center;
            color: var(--tg-theme-hint-color, #999);
            padding: 40px 20px;
            font-style: italic;
        }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #FFD700;
            color: #2c3e50;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .toast.show {
            opacity: 1;
        }

        .emergency-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 8px 0;
        }

        .breathing-guide {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #2c3e50;
            border-radius: 12px;
            margin: 16px 0;
        }

        .breathing-circle {
            width: 100px;
            height: 100px;
            border: 3px solid #2c3e50;
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            animation: breathe 4s infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .technique-card {
            background: var(--tg-theme-bg-color, white);
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
        }

        .technique-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000);
        }

        .reminder-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }

        .reminder-info {
            font-size: 14px;
            color: #856404;
            margin-bottom: 12px;
        }

        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }
            
            .header {
                margin: -12px -12px 16px -12px;
                padding: 16px 12px;
            }
            
            .tab-btn {
                font-size: 10px;
                padding: 10px 4px;
                min-width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–†–∞–±–æ—á–∞—è —Ç–µ—Ç—Ä–∞–¥—å —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—è</h1>
            <p>–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –±–∞—Ä—å–µ—Ä–æ–≤ –≤ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('dashboard')">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="tab-btn" onclick="switchTab('journal')">–ñ—É—Ä–Ω–∞–ª</button>
            <button class="tab-btn" onclick="switchTab('summaries')">–°–≤–æ–¥–∫–∏</button>
            <button class="tab-btn" onclick="switchTab('diagnosis')">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
            <button class="tab-btn" onclick="switchTab('defense')">–ó–∞—â–∏—Ç—ã</button>
            <button class="tab-btn" onclick="switchTab('symbols')">–°–∏–º–≤–æ–ª—ã</button>
            <button class="tab-btn" onclick="switchTab('plan')">–ü–ª–∞–Ω</button>
            <button class="tab-btn" onclick="switchTab('emergency')">SOS</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="section">
                <div class="section-title">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="completedDays">0</div>
                        <div class="stat-label">–î–Ω–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="currentStreak">0</div>
                        <div class="stat-label">–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgAnxiety">-</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ç—Ä–µ–≤–æ–≥–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedSections">0</div>
                        <div class="stat-label">–†–∞–∑–¥–µ–ª–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ç—Ä–µ–∫–µ—Ä</div>
                <div class="daily-tracker" id="dailyTracker"></div>
                
                <div class="input-group">
                    <label class="input-label">–£—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–≥–∏ —Å–µ–≥–æ–¥–Ω—è (1-10)</label>
                    <div class="scale-input">
                        <span>1</span>
                        <input type="range" class="scale-slider" min="1" max="10" value="5" id="todayAnxiety" oninput="updateAnxietyValue(this.value)">
                        <span>10</span>
                        <div class="scale-value" id="anxietyValue">5</div>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">–ó–∞–º–µ—Ç–∫–∏ –¥–Ω—è</label>
                    <textarea class="input-field textarea" id="todayNotes" placeholder="–ß—Ç–æ –≤–∞–∂–Ω–æ–≥–æ –∑–∞–º–µ—Ç–∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è?"></textarea>
                </div>

                <button class="btn" onclick="saveDailyEntry()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å –¥–Ω—è</button>
            </div>

            <div class="reminder-section">
                <div class="section-title">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
                <div class="reminder-info">
                    –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–µ—Ç—Ä–∞–¥–∏:
                </div>
                <ol style="margin-left: 20px; color: #856404;">
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram</li>
                    <li>–ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∑–≤—É–∫–∏"</li>
                    <li>–í–∫–ª—é—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –±–æ—Ç–æ–≤</li>
                    <li>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Ä–µ–º—è "–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å" —Ç–∞–∫, —á—Ç–æ–±—ã –≤ –≤–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è (19-21) —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥–∏–ª–∏</li>
                </ol>
                <div style="font-size: 12px; color: #856404; margin-top: 8px;">
                    –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∑–∞–ø–æ–ª–Ω—è—Ç—å —Ç–µ—Ç—Ä–∞–¥—å –∫–∞–∂–¥—ã–π –≤–µ—á–µ—Ä –≤ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤—Ä–µ–º—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏.
                </div>
            </div>
        </div>

        <!-- Journal Tab -->
        <div id="journal" class="tab-content">
            <div class="section">
                <div class="section-title">–ñ—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π</div>
                
                <input type="text" class="search-box" id="journalSearch" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∑–∞–ø–∏—Å—è–º..." oninput="filterJournal()">
                
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterJournalByType('all')">–í—Å–µ</button>
                    <button class="filter-btn" onclick="filterJournalByType('daily')">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ</button>
                    <button class="filter-btn" onclick="filterJournalByType('defense')">–ó–∞—â–∏—Ç—ã</button>
                    <button class="filter-btn" onclick="filterJournalByType('symbols')">–°–∏–º–≤–æ–ª—ã</button>
                    <button class="filter-btn" onclick="filterJournalByType('diagnosis')">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
                </div>
                
                <div id="journalEntries">
                    <div class="no-entries">–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–¥–µ–ª—ã!</div>
                </div>
            </div>
        </div>

        <!-- Weekly Summaries Tab -->
        <div id="summaries" class="tab-content">
            <div class="section">
                <div class="section-title">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Å–≤–æ–¥–∫–∏</div>
                <p style="margin-bottom: 16px;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–¥–∫–∏ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞ –Ω–µ–¥–µ–ª—é –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏–∫–∏.</p>
                
                <button class="btn" onclick="generateWeeklySummary()">üìä –°–æ–∑–¥–∞—Ç—å —Å–≤–æ–¥–∫—É –∑–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é</button>
                
                <div id="weeklySummaries">
                    <div class="no-entries">–°–≤–æ–¥–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</div>
                </div>
            </div>
        </div>

        <!-- Diagnosis Tab -->
        <div id="diagnosis" class="tab-content">
            <div class="section">
                <div class="section-title">–ö–∞—Ä—Ç–∞ —Ç–µ–∫—É—â–µ–π –∂–∏–∑–Ω–∏</div>
                <p style="margin-bottom: 16px;">–û—Ü–µ–Ω–∏—Ç–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ —à–∫–∞–ª–µ 1-10:</p>
                
                <div class="input-group">
                    <label class="input-label">–ö–∞—Ä—å–µ—Ä–∞ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è</label>
                    <div class="scale-input">
                        <span>1</span>
                        <input type="range" class="scale-slider" min="1" max="10" value="5" id="careerSat" oninput="updateScaleValue('career', this.value)">
                        <span>10</span>
                        <div class="scale-value" id="careerValue">5</div>
                    </div>
                    <textarea class="input-field" id="careerNotes" placeholder="–ß—Ç–æ –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç..."></textarea>
                </div>

                <div class="input-group">
                    <label class="input-label">–û—Ç–Ω–æ—à–µ–Ω–∏—è (—Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ)</label>
                    <div class="scale-input">
                        <span>1</span>
                        <input type="range" class="scale-slider" min="1" max="10" value="5" id="relationshipSat" oninput="updateScaleValue('relationship', this.value)">
                        <span>10</span>
                        <div class="scale-value" id="relationshipValue">5</div>
                    </div>
                    <textarea class="input-field" id="relationshipNotes" placeholder="–ß—Ç–æ –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç..."></textarea>
                </div>

                <div class="input-group">
                    <label class="input-label">–°–µ–º—å—è –∏ –¥—Ä—É–∑—å—è</label>
                    <div class="scale-input">
                        <span>1</span>
                        <input type="range" class="scale-slider" min="1" max="10" value="5" id="familySat" oninput="updateScaleValue('family', this.value)">
                        <span>10</span>
                        <div class="scale-value" id="familyValue">5</div>
                    </div>
                    <textarea class="input-field" id="familyNotes" placeholder="–ß—Ç–æ –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç..."></textarea>
                </div>

                <div class="input-group">
                    <label class="input-label">–ó–¥–æ—Ä–æ–≤—å–µ –∏ —ç–Ω–µ—Ä–≥–∏—è</label>
                    <div class="scale-input">
                        <span>1</span>
                        <input type="range" class="scale-slider" min="1" max="10" value="5" id="healthSat" oninput="updateScaleValue('health', this.value)">
                        <span>10</span>
                        <div class="scale-value" id="healthValue">5</div>
                    </div>
                    <textarea class="input-field" id="healthNotes" placeholder="–ß—Ç–æ –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç..."></textarea>
                </div>

                <div class="input-group">
                    <label class="input-label">–§–∏–Ω–∞–Ω—Å—ã</label>
                    <div class="scale-input">
                        <span>1</span>
                        <input type="range" class="scale-slider" min="1" max="10" value="5" id="financeSat" oninput="updateScaleValue('finance', this.value)">
                        <span>10</span>
                        <div class="scale-value" id="financeValue">5</div>
                    </div>
                    <textarea class="input-field" id="financeNotes" placeholder="–ß—Ç–æ –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç..."></textarea>
                </div>

                <button class="btn" onclick="saveDiagnosis()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
            </div>

            <div class="section">
                <div class="section-title">–ó–∞—Å—Ç—Ä—è–≤—à–∏–µ —Ü–µ–ª–∏</div>
                
                <div class="input-group">
                    <label class="input-label">–¶–µ–ª—å 1</label>
                    <input type="text" class="input-field" id="goal1" placeholder="–¶–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –¥–≤–∏–∂–µ—Ç—Å—è...">
                    <input type="text" class="input-field" id="goal1Time" placeholder="–ö–∞–∫ –¥–æ–ª–≥–æ –Ω–µ –¥–≤–∏–∂–µ—Ç—Å—è?" style="margin-top: 8px;">
                    <textarea class="input-field" id="goal1Reasons" placeholder="–§–æ—Ä–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã..." style="margin-top: 8px;"></textarea>
                </div>

                <div class="input-group">
                    <label class="input-label">–¶–µ–ª—å 2</label>
                    <input type="text" class="input-field" id="goal2" placeholder="–¶–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –¥–≤–∏–∂–µ—Ç—Å—è...">
                    <input type="text" class="input-field" id="goal2Time" placeholder="–ö–∞–∫ –¥–æ–ª–≥–æ –Ω–µ –¥–≤–∏–∂–µ—Ç—Å—è?" style="margin-top: 8px;">
                    <textarea class="input-field" id="goal2Reasons" placeholder="–§–æ—Ä–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã..." style="margin-top: 8px;"></textarea>
                </div>

                <button class="btn" onclick="saveGoals()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª–∏</button>
            </div>
        </div>

        <!-- Defense Tab -->
        <div id="defense" class="tab-content">
            <div class="section">
                <div class="section-title">–î–Ω–µ–≤–Ω–∏–∫ –∑–∞—â–∏—Ç–Ω—ã—Ö —Ä–µ–∞–∫—Ü–∏–π</div>
                <p style="margin-bottom: 16px;">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –º–æ–º–µ–Ω—Ç—ã –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏ —Å–≤–æ–∏ —Ä–µ–∞–∫—Ü–∏–∏:</p>
                
                <div class="input-group">
                    <label class="input-label">–°–∏—Ç—É–∞—Ü–∏—è, –≤—ã–∑–≤–∞–≤—à–∞—è –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç</label>
                    <textarea class="input-field" id="defenseReason" placeholder="–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?"></textarea>
                </div>

                <div class="input-group">
                    <label class="input-label">–í–∞—à–∞ –ø–µ—Ä–≤–∞—è —Ä–µ–∞–∫—Ü–∏—è</label>
                    <textarea class="input-field" id="defenseReaction" placeholder="–ß—Ç–æ –ø–æ–¥—É–º–∞–ª–∏/—Å–¥–µ–ª–∞–ª–∏ –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º?"></textarea>
                </div>

                <button class="btn" onclick="addDefenseEntry()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
            </div>

            <div class="section">
                <div class="section-title">–ê–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö –∑–∞—â–∏—Ç</div>
                
                <div class="input-group">
                    <label class="input-label">–ö–∞–∫–∏–µ –∑–∞—â–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —á–∞—â–µ –≤—Å–µ–≥–æ?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <div class="checkbox" onclick="toggleCheckbox('denial')" id="denialCheck"></div>
                            <span>–û—Ç—Ä–∏—Ü–∞–Ω–∏–µ ("–í—Å–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ")</span>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox" onclick="toggleCheckbox('projection')" id="projectionCheck"></div>
                            <span>–ü—Ä–æ–µ–∫—Ü–∏—è ("–û–Ω–∏ –≤–∏–Ω–æ–≤–∞—Ç—ã")</span>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox" onclick="toggleCheckbox('rationalization')" id="rationalizationCheck"></div>
                            <span>–†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è ("–£ –º–µ–Ω—è –µ—Å—Ç—å –ø—Ä–∏—á–∏–Ω—ã")</span>
                        </div>
                        <div class="checkbox-item">
                            <div class="checkbox" onclick="toggleCheckbox('avoidance')" id="avoidanceCheck"></div>
                            <span>–ò–∑–±–µ–≥–∞–Ω–∏–µ ("–õ—É—á—à–µ –Ω–µ —Ä–∏—Å–∫–æ–≤–∞—Ç—å")</span>
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="saveDefenseAnalysis()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>
            </div>
        </div>

        <!-- Symbols Tab -->
        <div id="symbols" class="tab-content">
            <div class="section">
                <div class="section-title">–°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–π –¥–Ω–µ–≤–Ω–∏–∫</div>
                
                <div class="input-group">
                    <label class="input-label">–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π —Å–æ–Ω</label>
                    <textarea class="input-field" id="todayDream" placeholder="–ß—Ç–æ —Å–Ω–∏–ª–æ—Å—å? (–¥–∞–∂–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)"></textarea>
                </div>

                <div class="input-group">
                    <label class="input-label">–≠–º–æ—Ü–∏—è –æ—Ç —Å–Ω–∞</label>
                    <input type="text" class="input-field" id="dreamEmotion" placeholder="–ß—Ç–æ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –≤–æ —Å–Ω–µ –∏ –ø–æ—Å–ª–µ?">
                </div>

                <div class="input-group">
                    <label class="input-label">–û–≥–æ–≤–æ—Ä–∫–∏, –∑–∞–±—ã–≤—á–∏–≤–æ—Å—Ç—å</label>
                    <textarea class="input-field" id="slipsOfTongue" placeholder="–ß—Ç–æ —Å–∫–∞–∑–∞–ª–∏ –Ω–µ —Ç–æ –∏–ª–∏ –∑–∞–±—ã–ª–∏?"></textarea>
                </div>

                <button class="btn" onclick="addSymbolEntry()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –¥–Ω—è</button>
            </div>
        </div>

        <!-- Plan Tab -->
        <div id="plan" class="tab-content">
            <div class="section">
                <div class="section-title">–ú–µ—Å—è—á–Ω—ã–π –ø–ª–∞–Ω</div>
                
                <div class="input-group">
                    <label class="input-label">–§–æ–∫—É—Å –º–µ—Å—è—Ü–∞</label>
                    <input type="text" class="input-field" id="monthFocus" placeholder="–ù–∞–¥ —á–µ–º —Ä–∞–±–æ—Ç–∞–µ–º?">
                </div>

                <div class="input-group">
                    <label class="input-label">–ù–µ–¥–µ–ª—è 1 - –î–µ–π—Å—Ç–≤–∏–µ</label>
                    <input type="text" class="input-field" id="week1Action" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ">
                </div>

                <div class="input-group">
                    <label class="input-label">–ù–µ–¥–µ–ª—è 2 - –î–µ–π—Å—Ç–≤–∏–µ</label>
                    <input type="text" class="input-field" id="week2Action" placeholder="–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ">
                </div>

                <button class="btn" onclick="saveMonthlyPlan()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω</button>
            </div>
        </div>

        <!-- Emergency Tab -->
        <div id="emergency" class="tab-content">
            <div class="section">
                <div class="section-title">SOS: –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–º–æ—â—å</div>
                
                <button class="emergency-btn" onclick="startBreathingExercise()">ü´Å –î—ã—Ö–∞—Ç–µ–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ 4-7-8</button>
                <button class="emergency-btn" onclick="show54321Technique()">üß† –¢–µ—Ö–Ω–∏–∫–∞ –∑–∞–∑–µ–º–ª–µ–Ω–∏—è 5-4-3-2-1</button>
                <button class="emergency-btn" onclick="showSelfCompassion()">üíù –ü—Ä–∞–∫—Ç–∏–∫–∞ —Å–∞–º–æ—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è</button>
                <button class="emergency-btn" onclick="showProgressReminder()">üìà –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ</button>
            </div>

            <div class="breathing-guide" id="breathingGuide" style="display: none;">
                <h3>–î—ã—Ö–∞—Ç–µ–ª—å–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ 4-7-8</h3>
                <div class="breathing-circle" id="breathingCircle">–í–¥–æ—Ö 4</div>
                <p>–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ –∫—Ä—É–≥–µ</p>
                <button class="btn btn-secondary" onclick="stopBreathingExercise()">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            </div>

            <div class="technique-card" id="technique54321" style="display: none;">
                <div class="technique-title">–¢–µ—Ö–Ω–∏–∫–∞ –∑–∞–∑–µ–º–ª–µ–Ω–∏—è 5-4-3-2-1</div>
                <p><strong>–ù–∞–∑–æ–≤–∏—Ç–µ:</strong></p>
                <ul>
                    <li>5 –≤–µ—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –í–ò–î–ò–¢–ï</li>
                    <li>4 –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –°–õ–´–®–ò–¢–ï</li>
                    <li>3 –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç–µ –ü–û–¢–†–û–ì–ê–¢–¨</li>
                    <li>2 –∑–∞–ø–∞—Ö–∞, –∫–æ—Ç–æ—Ä—ã–µ –ß–£–í–°–¢–í–£–ï–¢–ï</li>
                    <li>1 –≤–∫—É—Å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç–µ –†–ê–ó–õ–ò–ß–ò–¢–¨</li>
                </ul>
                <button class="btn btn-secondary" onclick="hide54321Technique()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>

            <div class="technique-card" id="selfCompassionCard" style="display: none;">
                <div class="technique-title">–ü—Ä–∞–∫—Ç–∏–∫–∞ —Å–∞–º–æ—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è</div>
                <p><strong>–°–∫–∞–∂–∏—Ç–µ —Å–µ–±–µ:</strong></p>
                <ul>
                    <li>"–°–µ–π—á–∞—Å –º–Ω–µ —Ç—Ä—É–¥–Ω–æ, –∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ"</li>
                    <li>"–¢—Ä—É–¥–Ω–æ—Å—Ç–∏ ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞"</li>
                    <li>"–Ø –æ—Ç–Ω–æ—à—É—Å—å –∫ —Å–µ–±–µ —Å –¥–æ–±—Ä–æ—Ç–æ–π –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º"</li>
                    <li>"–ß—Ç–æ –±—ã —è —Å–∫–∞–∑–∞–ª –ª—É—á—à–µ–º—É –¥—Ä—É–≥—É –≤ —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?"</li>
                </ul>
                <button class="btn btn-secondary" onclick="hideSelfCompassion()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Toast for notifications -->
    <div class="toast" id="toast"></div>

    <script>
        // Initialize Telegram WebApp
        let tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // Data storage
        let appData = {
            progress: {
                completedDays: 0,
                currentStreak: 0,
                completedSections: 0,
                dailyEntries: [],
                anxietyHistory: []
            },
            journalEntries: [],
            weeklySummaries: []
        };

        // Load data from localStorage
        function loadData() {
            try {
                const savedData = localStorage.getItem('psychoanalysisData');
                if (savedData) {
                    appData = { ...appData, ...JSON.parse(savedData) };
                    updateDashboard();
                    updateProgressBar();
                    initializeDailyTracker();
                    loadJournalEntries();
                    loadWeeklySummaries();
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('psychoanalysisData', JSON.stringify(appData));
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Show toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hide all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Mark button as active
            event.target.classList.add('active');
        }

        // Update anxiety value display
        function updateAnxietyValue(value) {
            const display = document.getElementById('anxietyValue');
            if (display) {
                display.textContent = value;
            }
        }

        // Update scale value display
        function updateScaleValue(type, value) {
            const display = document.getElementById(type + 'Value');
            if (display) {
                display.textContent = value;
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const totalSections = 8; // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
            const completed = appData.progress.completedSections;
            const percentage = Math.min((completed / totalSections) * 100, 100);
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = percentage + '%';
            }
        }

        // Update dashboard stats
        function updateDashboard() {
            const elements = {
                completedDays: document.getElementById('completedDays'),
                currentStreak: document.getElementById('currentStreak'),
                completedSections: document.getElementById('completedSections'),
                avgAnxiety: document.getElementById('avgAnxiety')
            };

            if (elements.completedDays) {
                elements.completedDays.textContent = appData.progress.completedDays;
            }
            if (elements.currentStreak) {
                elements.currentStreak.textContent = appData.progress.currentStreak;
            }
            if (elements.completedSections) {
                elements.completedSections.textContent = appData.progress.completedSections;
            }
            
            // Calculate average anxiety
            if (elements.avgAnxiety && appData.progress.anxietyHistory.length > 0) {
                const avg = appData.progress.anxietyHistory.reduce((a, b) => a + b, 0) / appData.progress.anxietyHistory.length;
                elements.avgAnxiety.textContent = avg.toFixed(1);
            }
        }

        // Initialize daily tracker
        function initializeDailyTracker() {
            const tracker = document.getElementById('dailyTracker');
            if (!tracker) return;
            
            tracker.innerHTML = '';
            
            for (let i = 0; i < 28; i++) {
                const day = document.createElement('div');
                day.className = 'day-cell';
                day.textContent = i + 1;
                
                const today = new Date().getDate();
                if (i + 1 === today) {
                    day.classList.add('current');
                }
                
                if (appData.progress.dailyEntries.includes(i + 1)) {
                    day.classList.add('completed');
                }
                
                tracker.appendChild(day);
            }
        }

        // Add entry to journal
        function addJournalEntry(type, title, content, data = {}) {
            const entry = {
                id: Date.now(),
                date: new Date().toISOString(),
                type: type,
                title: title,
                content: content,
                data: data
            };
            
            if (!appData.journalEntries) {
                appData.journalEntries = [];
            }
            
            appData.journalEntries.unshift(entry);
            saveData();
            loadJournalEntries();
        }

        // Delete journal entry
        function deleteJournalEntry(entryId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) {
                appData.journalEntries = appData.journalEntries.filter(entry => entry.id !== entryId);
                saveData();
                loadJournalEntries();
                showToast('–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        // Load and display journal entries
        function loadJournalEntries() {
            const container = document.getElementById('journalEntries');
            if (!container) return;
            
            if (!appData.journalEntries || appData.journalEntries.length === 0) {
                container.innerHTML = '<div class="no-entries">–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç. –ù–∞—á–Ω–∏—Ç–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–¥–µ–ª—ã!</div>';
                return;
            }
            
            let html = '';
            appData.journalEntries.forEach(entry => {
                const date = new Date(entry.date).toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                html += `
                    <div class="journal-entry" data-type="${entry.type}">
                        <button class="delete-btn" onclick="deleteJournalEntry(${entry.id})" title="–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å">√ó</button>
                        <div class="journal-date">
                            <span class="journal-type">${getTypeLabel(entry.type)}</span>
                            ${date}
                        </div>
                        <div class="journal-content">
                            <strong>${entry.title}</strong><br>
                            ${entry.content}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Get type label for journal entries
        function getTypeLabel(type) {
            const labels = {
                'daily': '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞–ø–∏—Å—å',
                'defense': '–ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã',
                'symbols': '–°–∏–º–≤–æ–ª—ã',
                'diagnosis': '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞',
                'goals': '–¶–µ–ª–∏',
                'plan': '–ü–ª–∞–Ω'
            };
            return labels[type] || type;
        }

        // Filter journal by type
        function filterJournalByType(type) {
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const entries = document.querySelectorAll('.journal-entry');
            entries.forEach(entry => {
                if (type === 'all' || entry.dataset.type === type) {
                    entry.style.display = 'block';
                } else {
                    entry.style.display = 'none';
                }
            });
        }

        // Filter journal by search
        function filterJournal() {
            const searchTerm = document.getElementById('journalSearch').value.toLowerCase();
            const entries = document.querySelectorAll('.journal-entry');
            
            entries.forEach(entry => {
                const content = entry.textContent.toLowerCase();
                if (content.includes(searchTerm)) {
                    entry.style.display = 'block';
                } else {
                    entry.style.display = 'none';
                }
            });
        }

        // Generate weekly summary
        function generateWeeklySummary() {
            const weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
            weekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 7);
            
            // Filter entries from this week
            const weekEntries = appData.journalEntries ? appData.journalEntries.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate >= weekStart && entryDate < weekEnd;
            }) : [];
            
            // Calculate stats
            const anxietyThisWeek = appData.progress.anxietyHistory.slice(-7);
            const avgAnxiety = anxietyThisWeek.length > 0 ? 
                (anxietyThisWeek.reduce((a, b) => a + b, 0) / anxietyThisWeek.length).toFixed(1) : '–Ω/–¥';
            
            // Group entries by type
            const entriesByType = {};
            weekEntries.forEach(entry => {
                if (!entriesByType[entry.type]) {
                    entriesByType[entry.type] = [];
                }
                entriesByType[entry.type].push(entry);
            });
            
            // Create summary
            const summary = {
                id: Date.now(),
                weekStart: weekStart.toISOString(),
                weekEnd: weekEnd.toISOString(),
                totalEntries: weekEntries.length,
                avgAnxiety: avgAnxiety,
                entriesByType: entriesByType,
                keyInsights: generateKeyInsights(weekEntries),
                created: new Date().toISOString()
            };
            
            if (!appData.weeklySummaries) {
                appData.weeklySummaries = [];
            }
            
            appData.weeklySummaries.unshift(summary);
            saveData();
            loadWeeklySummaries();
            showToast('–°–≤–æ–¥–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é —Å–æ–∑–¥–∞–Ω–∞!');
        }

        // Generate key insights
        function generateKeyInsights(entries) {
            const insights = [];
            
            // Count entries by type
            const typeCount = {};
            entries.forEach(entry => {
                typeCount[entry.type] = (typeCount[entry.type] || 0) + 1;
            });
            
            // Most active area
            const mostActive = Object.entries(typeCount).sort((a, b) => b[1] - a[1])[0];
            if (mostActive) {
                insights.push(`–ë–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å: ${getTypeLabel(mostActive[0])} (${mostActive[1]} –∑–∞–ø–∏—Å–µ–π)`);
            }
            
            if (entries.length === 0) {
                insights.push('–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –∑–∞–ø–∏—Å–µ–π –Ω–µ –±—ã–ª–æ - –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–µ–µ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ–º!');
            } else if (entries.length >= 7) {
                insights.push('–û—Ç–ª–∏—á–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å! –î–µ–ª–∞–ª–∏ –∑–∞–ø–∏—Å–∏ –ø–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å');
            }
            
            return insights;
        }

        // Load weekly summaries
        function loadWeeklySummaries() {
            const container = document.getElementById('weeklySummaries');
            if (!container) return;
            
            if (!appData.weeklySummaries || appData.weeklySummaries.length === 0) {
                container.innerHTML = '<div class="no-entries">–°–≤–æ–¥–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</div>';
                return;
            }
            
            let html = '';
            appData.weeklySummaries.forEach(summary => {
                const weekStart = new Date(summary.weekStart).toLocaleDateString('ru-RU');
                const weekEnd = new Date(summary.weekEnd).toLocaleDateString('ru-RU');
                
                html += `
                    <div class="weekly-summary">
                        <button class="delete-btn" onclick="deleteWeeklySummary(${summary.id})" title="–£–¥–∞–ª–∏—Ç—å —Å–≤–æ–¥–∫—É">√ó</button>
                        <div class="summary-title">–°–≤–æ–¥–∫–∞ ${weekStart} - ${weekEnd}</div>
                        
                        <div class="summary-section">
                            <div class="summary-label">–û–±—â–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</div>
                            –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${summary.totalEntries}<br>
                            –°—Ä–µ–¥–Ω—è—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å: ${summary.avgAnxiety}/10
                        </div>
                        
                        <div class="summary-section">
                            <div class="summary-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º:</div>
                            ${Object.entries(summary.entriesByType).map(([type, entries]) => 
                                `${getTypeLabel(type)}: ${entries.length} –∑–∞–ø–∏—Å–µ–π`
                            ).join('<br>') || '–ó–∞–ø–∏—Å–µ–π –Ω–µ –±—ã–ª–æ'}
                        </div>
                        
                        <div class="summary-section">
                            <div class="summary-label">–ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã:</div>
                            ${summary.keyInsights.map(insight => `‚Ä¢ ${insight}`).join('<br>')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Delete weekly summary
        function deleteWeeklySummary(summaryId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–≤–æ–¥–∫—É?')) {
                appData.weeklySummaries = appData.weeklySummaries.filter(summary => summary.id !== summaryId);
                saveData();
                loadWeeklySummaries();
                showToast('–°–≤–æ–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        // Checkbox toggle
        function toggleCheckbox(id) {
            const checkbox = document.getElementById(id + 'Check');
            if (checkbox) {
                checkbox.classList.toggle('checked');
            }
        }

        // Save daily entry
        function saveDailyEntry() {
            const anxietySlider = document.getElementById('todayAnxiety');
            const notesField = document.getElementById('todayNotes');
            
            if (!anxietySlider || !notesField) return;
            
            const anxiety = anxietySlider.value;
            const notes = notesField.value;
            const today = new Date().getDate();
            
            appData.progress.anxietyHistory.push(parseInt(anxiety));
            if (!appData.progress.dailyEntries.includes(today)) {
                appData.progress.dailyEntries.push(today);
                appData.progress.completedDays++;
                
                // Update streak
                if (appData.progress.dailyEntries.includes(today - 1) || today === 1) {
                    appData.progress.currentStreak++;
                } else {
                    appData.progress.currentStreak = 1;
                }
            }
            
            // Add to journal
            addJournalEntry('daily', 
                `–ó–∞–ø–∏—Å—å –¥–Ω—è - —Ç—Ä–µ–≤–æ–≥–∞ ${anxiety}/10`, 
                notes || '–ë–µ–∑ –∑–∞–º–µ—Ç–æ–∫',
                { anxiety: anxiety }
            );
            
            saveData();
            updateDashboard();
            initializeDailyTracker();
            showToast('–ó–∞–ø–∏—Å—å –¥–Ω—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }

        // Save diagnosis
        function saveDiagnosis() {
            const areas = ['career', 'relationship', 'family', 'health', 'finance'];
            let diagnosisText = '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ';
            
            areas.forEach(area => {
                const satSlider = document.getElementById(area + 'Sat');
                const notesField = document.getElementById(area + 'Notes');
                if (satSlider) {
                    const satisfaction = satSlider.value;
                    const notes = notesField ? notesField.value : '';
                    diagnosisText += `${getAreaLabel(area)}: ${satisfaction}/10`;
                    if (notes) diagnosisText += ` (${notes})`;
                    diagnosisText += '; ';
                }
            });
            
            addJournalEntry('diagnosis', '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å—Ñ–µ—Ä', diagnosisText);
            
            appData.progress.completedSections = Math.max(appData.progress.completedSections, 1);
            saveData();
            updateProgressBar();
            showToast('–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }

        // Get area label
        function getAreaLabel(area) {
            const labels = {
                'career': '–ö–∞—Ä—å–µ—Ä–∞',
                'relationship': '–û—Ç–Ω–æ—à–µ–Ω–∏—è',
                'family': '–°–µ–º—å—è',
                'health': '–ó–¥–æ—Ä–æ–≤—å–µ',
                'finance': '–§–∏–Ω–∞–Ω—Å—ã'
            };
            return labels[area] || area;
        }

        // Save goals
        function saveGoals() {
            let goalsText = '–ó–∞—Å—Ç—Ä—è–≤—à–∏–µ —Ü–µ–ª–∏: ';
            
            for (let i = 1; i <= 2; i++) {
                const goal = document.getElementById(`goal${i}`);
                const time = document.getElementById(`goal${i}Time`);
                const reasons = document.getElementById(`goal${i}Reasons`);
                
                if (goal && goal.value) {
                    goalsText += `${i}. ${goal.value}`;
                    if (time && time.value) goalsText += ` (–∑–∞—Å—Ç—Ä—è–ª–∞: ${time.value})`;
                    if (reasons && reasons.value) goalsText += ` - –ø—Ä–∏—á–∏–Ω—ã: ${reasons.value}`;
                    goalsText += '; ';
                }
            }
            
            addJournalEntry('goals', '–ê–Ω–∞–ª–∏–∑ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö —Ü–µ–ª–µ–π', goalsText);
            
            appData.progress.completedSections = Math.max(appData.progress.completedSections, 2);
            saveData();
            updateProgressBar();
            showToast('–¶–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        // Add defense entry
        function addDefenseEntry() {
            const reason = document.getElementById('defenseReason');
            const reaction = document.getElementById('defenseReaction');
            
            if (!reason || !reaction) return;
            
            const reasonText = reason.value;
            const reactionText = reaction.value;
            
            if (!reasonText.trim() || !reactionText.trim()) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            addJournalEntry('defense', 
                '–ó–∞—â–∏—Ç–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è', 
                `–°–∏—Ç—É–∞—Ü–∏—è: ${reasonText}. –†–µ–∞–∫—Ü–∏—è: ${reactionText}`
            );
            
            // Clear form
            reason.value = '';
            reaction.value = '';
            
            saveData();
            showToast('–ó–∞–ø–∏—Å—å –æ –∑–∞—â–∏—Ç–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        }

        // Save defense analysis
        function saveDefenseAnalysis() {
            const defenses = [];
            ['denial', 'projection', 'rationalization', 'avoidance'].forEach(defense => {
                const checkbox = document.getElementById(defense + 'Check');
                if (checkbox && checkbox.classList.contains('checked')) {
                    defenses.push(defense);
                }
            });
            
            const defenseText = defenses.length > 0 ? 
                `–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –∑–∞—â–∏—Ç—ã: ${defenses.join(', ')}` : 
                '–ó–∞—â–∏—Ç—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã';
            
            addJournalEntry('defense', '–ê–Ω–∞–ª–∏–∑ –∑–∞—â–∏—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤', defenseText);
            
            appData.progress.completedSections = Math.max(appData.progress.completedSections, 3);
            saveData();
            updateProgressBar();
            showToast('–ê–Ω–∞–ª–∏–∑ –∑–∞—â–∏—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        }

        // Add symbol entry
        function addSymbolEntry() {
            const dream = document.getElementById('todayDream');
            const dreamEmotion = document.getElementById('dreamEmotion');
            const slips = document.getElementById('slipsOfTongue');
            
            if (!dream || !dreamEmotion || !slips) return;
            
            const symbolText = `–°–æ–Ω: ${dream.value || '–Ω–µ –ø–æ–º–Ω—é'}. –≠–º–æ—Ü–∏—è: ${dreamEmotion.value || '–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è'}. –û–≥–æ–≤–æ—Ä–∫–∏: ${slips.value || '–Ω–µ –±—ã–ª–æ'}`;
            
            addJournalEntry('symbols', '–°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –¥–Ω—è', symbolText);
            
            // Clear form
            dream.value = '';
            dreamEmotion.value = '';
            slips.value = '';
            
            appData.progress.completedSections = Math.max(appData.progress.completedSections, 4);
            saveData();
            updateProgressBar();
            showToast('–°–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
        }

        // Save monthly plan
        function saveMonthlyPlan() {
            const monthFocus = document.getElementById('monthFocus');
            const week1Action = document.getElementById('week1Action');
            const week2Action = document.getElementById('week2Action');
            
            if (!monthFocus || !week1Action || !week2Action) return;
            
            const planText = `–§–æ–∫—É—Å: ${monthFocus.value}. –ù–µ–¥–µ–ª—è 1: ${week1Action.value}. –ù–µ–¥–µ–ª—è 2: ${week2Action.value}`;
            
            addJournalEntry('plan', '–ú–µ—Å—è—á–Ω—ã–π –ø–ª–∞–Ω —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏', planText);
            
            appData.progress.completedSections = Math.max(appData.progress.completedSections, 5);
            saveData();
            updateProgressBar();
            showToast('–ü–ª–∞–Ω –º–µ—Å—è—Ü–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        }

        // Emergency techniques
        function startBreathingExercise() {
            const guide = document.getElementById('breathingGuide');
            const circle = document.getElementById('breathingCircle');
            
            if (!guide || !circle) return;
            
            guide.style.display = 'block';
            
            let step = 0;
            const steps = ['–í–¥–æ—Ö 4', '–ó–∞–¥–µ—Ä–∂–∫–∞ 7', '–í—ã–¥–æ—Ö 8', '–ü–∞—É–∑–∞'];
            const durations = [4000, 7000, 8000, 1000];
            
            function breathingCycle() {
                circle.textContent = steps[step];
                
                setTimeout(() => {
                    step = (step + 1) % 4;
                    if (guide.style.display !== 'none') {
                        breathingCycle();
                    }
                }, durations[step]);
            }
            
            breathingCycle();
        }

        function stopBreathingExercise() {
            const guide = document.getElementById('breathingGuide');
            if (guide) {
                guide.style.display = 'none';
            }
        }

        function show54321Technique() {
            const technique = document.getElementById('technique54321');
            if (technique) {
                technique.style.display = 'block';
            }
        }

        function hide54321Technique() {
            const technique = document.getElementById('technique54321');
            if (technique) {
                technique.style.display = 'none';
            }
        }

        function showSelfCompassion() {
            const card = document.getElementById('selfCompassionCard');
            if (card) card.style.display = 'block';
        }

        function hideSelfCompassion() {
            const card = document.getElementById('selfCompassionCard');
            if (card) card.style.display = 'none';
        }

        function showProgressReminder() {
            const completedDays = appData.progress.completedDays;
            const completedSections = appData.progress.completedSections;
            
            showToast(`–í—ã —É–∂–µ –ø—Ä–æ—à–ª–∏ ${completedDays} –¥–Ω–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –∑–∞–ø–æ–ª–Ω–∏–ª–∏ ${completedSections} —Ä–∞–∑–¥–µ–ª–æ–≤. –≠—Ç–æ –±–æ–ª—å—à–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å!`);
        }

        // Initialize app when page loads
        function initializeApp() {
            loadData();
            
            // Set up Telegram WebApp main button
            if (tg && tg.MainButton) {
                tg.MainButton.setText('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å');
                tg.MainButton.onClick(function() {
                    saveData();
                    showToast('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                });
                tg.MainButton.show();
            }
            
            // Auto-save every 5 minutes
            setInterval(saveData, 300000);
        }

        // Handle page visibility change to save data
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') {
                saveData();
            }
        });

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // Fallback initialization
        window.addEventListener('load', initializeApp);
    </script>
</body>
</html>
